#!/usr/bin/python3
#
# Vulnerability.py - describe a single vulnerability
#

from datetime import datetime


class Vulnerability:
    def __init__(self, dirpath: str, package: str, vulnid: str, severity: str, description: str):
        self.dirpath = dirpath
        self.package = package
        self.vulnid = vulnid if vulnid != "" else "unknown CVE ID"
        self.severity = severity
        self.description = description
        self.timestamp = datetime.now().isoformat()

    def __eq__(self, other):
        return \
            self.dirpath == other.dirpath and \
            self.package == other.package and \
            self.vulnid == other.vulnid and \
            self.severity == other.severity and \
            self.description == other.description

    def to_ecs(self):
        return {
            "timestamp": self.timestamp,
            "service": {
                "name": "dep-vuln-checker"
            },
            "vulnerability": {
                "id": self.vulnid,
                "severity": self.severity,
                "description": self.description
            },
            "package": {
                "name": self.package
            },
            "file": {
                "directory": self.dirpath
            }
        }

    def to_csv(self):
        return ','.join([
            self.timestamp,
            self.dirpath,
            self.package,
            self.severity,
            self.vulnid])
